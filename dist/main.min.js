var Coframejs;(()=>{"use strict";var e={d:(n,t)=>{for(var o in t)e.o(t,o)&&!e.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:t[o]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},n={};function replaceNodeContent(e,n,t){const o=document.createDocumentFragment();for(const a of Array.from(e.childNodes))if(a.nodeType===Node.ELEMENT_NODE&&a.outerHTML.includes(n.innerHTML)){const e=a.outerHTML.replace(n.innerHTML,t.innerHTML),r=document.createElement("div");r.innerHTML=e,o.appendChild(r.firstChild)}else o.appendChild(a);e.textContent="",e.appendChild(o)}e.r(n),e.d(n,{getVariants:()=>getVariants,measureBounce:()=>measureBounce,measureConversion:()=>measureConversion,measureEngagement:()=>measureEngagement,sendDataToBackend:()=>sendDataToBackend});const t=1e4;let o=null,a=!1,r=!1,i=!0,s=[];async function getVariants(e,n,t,o){return(await fetch("https://coframe.ai/api/v1/retrieve_variants_page/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({coframe_page_id:e,time:n,languages:void 0!==t?t.languages||t.language:void 0,platform:void 0!==t?t.platform||t.userAgentData&&t.userAgentData.platform:void 0,referrer:o})})).json()}async function sendDataToBackend(e){try{return(await fetch("https://coframe.ai/api/v1/session_result/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}catch(e){console.error("Failed to send data:",e)}}function measureEngagement(){const e=new Date-o;e>=t?(a=!0,sendDataToBackend({engagement:!0,session_ids:s})):setTimeout(measureEngagement,t-e)}function measureConversion(){r=!0,i=!1,sendDataToBackend({conversion:!0,session_ids:s})}function measureBounce(){i&&sendDataToBackend({bounced:!0,session_ids:s})}const d={};d.init=async function(){var e=window.COFRAME_PAGE_ID;o=new Date,window.addEventListener("beforeunload",measureBounce),document.addEventListener("visibilitychange",measureEngagement),document.addEventListener("conversion",measureConversion),setTimeout(measureEngagement,t);const n=await getVariants(e,o,navigator,document.referrer),a=n.variants;s=n.session_ids;try{a.forEach((({original:e,copy:n})=>{!function replaceHTMLContent(e,n){const t=document.createElement("div");t.innerHTML=e;const o=document.createElement("div");o.innerHTML=n;const a=document.createTreeWalker(document.body,NodeFilter.SHOW_ELEMENT,null,!1);let r;for(;r=a.nextNode();)r.innerHTML.includes(e)&&replaceNodeContent(r,t,o)}(e,n)}))}catch{}},d.logCoframeConversion=function(){document.dispatchEvent(new CustomEvent("conversion",{}))},window.Coframe=d,d.init(),Coframejs=n})();